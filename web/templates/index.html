<!DOCTYPE html>
<html lang="zh-CN">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>EasyPanel</title>
<style>
*, *::before, *::after { box-sizing: border-box; margin: 0; padding: 0; }

:root {
  --accent: #4ade80;
  --accent2: #22c55e;
  --bg: #f0f4f8;
  --card: rgba(255,255,255,0.85);
  --text: #1e293b;
  --sub: #64748b;
  --radius: 18px;
  --shadow: 0 8px 32px rgba(0,0,0,0.12);
  --transition: 0.25s cubic-bezier(.4,0,.2,1);
}

body {
  font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
  background: var(--bg);
  color: var(--text);
  min-height: 100vh;
  overflow-x: hidden;
}

/* ===== LOGIN ===== */
#login-page {
  min-height: 100vh;
  display: flex;
  align-items: center;
  justify-content: center;
  position: relative;
  background: #e8f4f0;
}

.login-blob {
  position: fixed;
  border-radius: 50%;
  filter: blur(60px);
  opacity: 0.7;
  pointer-events: none;
}

.login-blob-1 { width: 300px; height: 300px; background: #86efac; top: -80px; right: -80px; }
.login-blob-2 { width: 200px; height: 200px; background: #fbbf24; bottom: -60px; right: -40px; }
.login-blob-3 { width: 250px; height: 250px; background: #4ade80; bottom: 20px; left: -60px; }
.login-blob-4 { width: 150px; height: 150px; background: #86efac; top: 100px; left: -30px; }

.login-card {
  background: rgba(255,255,255,0.75);
  backdrop-filter: blur(20px);
  border-radius: var(--radius);
  padding: 40px 48px 32px;
  width: 420px;
  box-shadow: var(--shadow);
  position: relative;
  z-index: 1;
  border: 1px solid rgba(255,255,255,0.6);
}

.login-logo {
  width: 36px; height: 36px;
  background: #e2e8f0;
  border-radius: 8px;
  display: flex; align-items: center; justify-content: center;
  margin-bottom: 16px;
  color: var(--sub);
}

.login-title {
  font-size: 28px;
  font-weight: 700;
  text-align: center;
  margin-bottom: 32px;
  color: var(--text);
}

.form-group {
  position: relative;
  margin-bottom: 16px;
}

.form-group input {
  width: 100%;
  padding: 14px 16px 14px 44px;
  border: 1.5px solid #e2e8f0;
  border-radius: 12px;
  font-size: 15px;
  background: rgba(255,255,255,0.9);
  outline: none;
  transition: border-color var(--transition);
  color: var(--text);
}

.form-group input:focus { border-color: var(--accent2); }

.form-group .input-icon {
  position: absolute;
  left: 14px;
  top: 50%;
  transform: translateY(-50%);
  color: #94a3b8;
  font-size: 16px;
}

.login-btn {
  width: 100%;
  padding: 14px;
  background: white;
  border: 1.5px solid #e2e8f0;
  border-radius: 12px;
  font-size: 16px;
  font-weight: 600;
  cursor: pointer;
  margin-top: 8px;
  transition: all var(--transition);
  color: var(--text);
}

.login-btn:hover {
  background: #f8fafc;
  border-color: #cbd5e1;
  transform: translateY(-1px);
}

.login-footer {
  text-align: center;
  margin-top: 20px;
  font-size: 13px;
  color: var(--sub);
}

.error-msg {
  color: #ef4444;
  font-size: 13px;
  margin-top: 8px;
  text-align: center;
  display: none;
}

/* ===== DASHBOARD ===== */
#dashboard-page { display: none; min-height: 100vh; position: relative; }

.wallpaper-bg {
  position: fixed; inset: 0; z-index: 0;
  background-size: cover; background-position: center;
  transition: background-image 0.5s;
}

.wallpaper-overlay {
  position: fixed; inset: 0; z-index: 0;
  background: rgba(0,0,0,0.15);
}

.dashboard-content {
  position: relative; z-index: 1;
  min-height: 100vh;
  padding: 0 40px 40px;
}

/* Header */
.dash-header {
  display: flex;
  justify-content: space-between;
  align-items: center;
  padding: 24px 0;
}

.dash-logo-area {
  display: flex; align-items: center; gap: 12px;
}

.dash-logo {
  width: 40px; height: 40px;
  border-radius: 10px;
  object-fit: cover;
  display: none;
}

.panel-title-text {
  font-size: 20px;
  font-weight: 700;
  color: white;
  text-shadow: 0 1px 4px rgba(0,0,0,0.3);
}

.settings-btn {
  width: 40px; height: 40px;
  background: rgba(255,255,255,0.2);
  backdrop-filter: blur(10px);
  border: 1px solid rgba(255,255,255,0.3);
  border-radius: 10px;
  cursor: pointer;
  display: flex; align-items: center; justify-content: center;
  color: white;
  font-size: 18px;
  transition: all var(--transition);
}

.settings-btn:hover { background: rgba(255,255,255,0.3); }

/* Hero info */
.hero-section {
  text-align: center;
  padding: 20px 0 40px;
  color: white;
}

.hero-hostname {
  font-size: 42px;
  font-weight: 800;
  text-shadow: 0 2px 8px rgba(0,0,0,0.3);
  margin-bottom: 4px;
}

.hero-time {
  font-size: 28px;
  font-weight: 600;
  opacity: 0.9;
  text-shadow: 0 1px 4px rgba(0,0,0,0.2);
}

.hero-date {
  font-size: 15px;
  opacity: 0.8;
  margin-top: 4px;
}

/* App grid */
.apps-section {
  max-width: 1200px;
  margin: 0 auto;
}

.group-label {
  color: rgba(255,255,255,0.9);
  font-size: 14px;
  font-weight: 600;
  text-transform: uppercase;
  letter-spacing: 1px;
  margin-bottom: 16px;
  text-shadow: 0 1px 3px rgba(0,0,0,0.3);
}

.apps-grid {
  display: flex;
  flex-wrap: wrap;
  gap: 20px;
  margin-bottom: 32px;
}

/* App card */
.app-card {
  position: relative;
  display: flex;
  flex-direction: column;
  align-items: center;
  gap: 8px;
  cursor: pointer;
  width: 90px;
}

.app-icon-wrap {
  width: 72px; height: 72px;
  border-radius: 18px;
  overflow: hidden;
  position: relative;
  transition: transform var(--transition), box-shadow var(--transition);
  box-shadow: 0 4px 16px rgba(0,0,0,0.2);
}

.app-card:hover .app-icon-wrap {
  transform: translateY(-4px) scale(1.05);
  box-shadow: 0 8px 24px rgba(0,0,0,0.3);
}

.app-icon {
  width: 100%; height: 100%;
  object-fit: cover;
  border-radius: 18px;
}

.app-icon-text {
  width: 100%; height: 100%;
  display: flex;
  align-items: center;
  justify-content: center;
  background: rgba(255,255,255,0.2);
  backdrop-filter: blur(10px);
  border: 1px solid rgba(255,255,255,0.3);
  border-radius: 18px;
  font-size: 22px;
  font-weight: 700;
  color: white;
  text-shadow: 0 1px 4px rgba(0,0,0,0.3);
}

.app-name {
  font-size: 12px;
  color: rgba(255,255,255,0.95);
  text-align: center;
  font-weight: 500;
  text-shadow: 0 1px 3px rgba(0,0,0,0.4);
  max-width: 80px;
  overflow: hidden;
  text-overflow: ellipsis;
  white-space: nowrap;
}

/* Hover action buttons */
.app-actions {
  position: absolute;
  top: -12px;
  right: -8px;
  display: none;
  gap: 4px;
  z-index: 10;
}

.app-card:hover .app-actions { display: flex; }

.app-action-btn {
  width: 26px; height: 26px;
  border-radius: 8px;
  border: none;
  cursor: pointer;
  display: flex;
  align-items: center;
  justify-content: center;
  font-size: 13px;
  transition: all var(--transition);
  box-shadow: 0 2px 8px rgba(0,0,0,0.2);
}

.app-action-btn.add {
  background: white;
  color: #22c55e;
}

.app-action-btn.edit {
  background: white;
  color: #3b82f6;
}

.app-action-btn.delete {
  background: white;
  color: #ef4444;
}

.app-action-btn:hover { transform: scale(1.1); }

/* Add app placeholder */
.add-app-card {
  width: 90px;
  display: flex;
  flex-direction: column;
  align-items: center;
  gap: 8px;
  cursor: pointer;
  opacity: 0.7;
  transition: opacity var(--transition);
}

.add-app-card:hover { opacity: 1; }

.add-app-icon {
  width: 72px; height: 72px;
  border-radius: 18px;
  border: 2px dashed rgba(255,255,255,0.6);
  display: flex;
  align-items: center;
  justify-content: center;
  font-size: 28px;
  color: rgba(255,255,255,0.8);
  transition: all var(--transition);
}

.add-app-card:hover .add-app-icon {
  border-color: white;
  background: rgba(255,255,255,0.1);
  transform: translateY(-2px);
}

.add-app-name {
  font-size: 12px;
  color: rgba(255,255,255,0.8);
}

/* ===== MODAL ===== */
.modal-overlay {
  position: fixed; inset: 0; z-index: 100;
  background: rgba(0,0,0,0.5);
  backdrop-filter: blur(4px);
  display: none;
  align-items: center;
  justify-content: center;
}

.modal-overlay.show { display: flex; }

.modal {
  background: white;
  border-radius: 20px;
  padding: 28px;
  width: 500px;
  max-width: 95vw;
  max-height: 90vh;
  overflow-y: auto;
  box-shadow: 0 20px 60px rgba(0,0,0,0.3);
  animation: modal-in 0.25s ease;
}

@keyframes modal-in {
  from { transform: scale(0.95) translateY(10px); opacity: 0; }
  to { transform: scale(1) translateY(0); opacity: 1; }
}

.modal-header {
  display: flex;
  justify-content: space-between;
  align-items: center;
  margin-bottom: 24px;
}

.modal-title {
  font-size: 18px;
  font-weight: 700;
  color: var(--text);
}

.modal-close {
  width: 32px; height: 32px;
  border: none;
  background: #f1f5f9;
  border-radius: 8px;
  cursor: pointer;
  font-size: 16px;
  display: flex; align-items: center; justify-content: center;
  color: var(--sub);
  transition: all var(--transition);
}

.modal-close:hover { background: #e2e8f0; color: var(--text); }

/* Preview */
.preview-area {
  background: #f8fafc;
  border-radius: 12px;
  padding: 16px;
  margin-bottom: 20px;
  display: flex;
  align-items: center;
  gap: 16px;
}

.preview-icon {
  width: 56px; height: 56px;
  border-radius: 14px;
  overflow: hidden;
  flex-shrink: 0;
  background: #e2e8f0;
  display: flex; align-items: center; justify-content: center;
  font-size: 18px;
  font-weight: 700;
  color: #64748b;
}

.preview-icon img { width: 100%; height: 100%; object-fit: cover; }

.preview-info .preview-title {
  font-size: 15px;
  font-weight: 600;
}

.preview-info .preview-url {
  font-size: 12px;
  color: var(--sub);
  margin-top: 2px;
}

/* Form */
.form-label {
  display: block;
  font-size: 13px;
  font-weight: 600;
  color: var(--sub);
  margin-bottom: 6px;
  text-transform: uppercase;
  letter-spacing: 0.5px;
}

.form-input {
  width: 100%;
  padding: 10px 14px;
  border: 1.5px solid #e2e8f0;
  border-radius: 10px;
  font-size: 14px;
  color: var(--text);
  outline: none;
  transition: border-color var(--transition);
  background: white;
}

.form-input:focus { border-color: var(--accent2); }

.form-row { margin-bottom: 16px; }

/* Icon type tabs */
.icon-tabs {
  display: flex;
  gap: 4px;
  background: #f1f5f9;
  border-radius: 10px;
  padding: 4px;
  margin-bottom: 12px;
}

.icon-tab {
  flex: 1;
  padding: 8px;
  border: none;
  background: transparent;
  border-radius: 7px;
  cursor: pointer;
  font-size: 13px;
  font-weight: 500;
  color: var(--sub);
  transition: all var(--transition);
}

.icon-tab.active {
  background: white;
  color: #22c55e;
  box-shadow: 0 1px 4px rgba(0,0,0,0.1);
  font-weight: 600;
}

/* Image upload area */
.image-upload-area {
  display: flex;
  gap: 8px;
  align-items: center;
}

.image-url-input { flex: 1; }

.upload-btn {
  padding: 10px 14px;
  border: 1.5px solid #e2e8f0;
  border-radius: 10px;
  background: white;
  cursor: pointer;
  font-size: 13px;
  font-weight: 500;
  color: var(--sub);
  white-space: nowrap;
  transition: all var(--transition);
  display: flex; align-items: center; gap: 6px;
}

.upload-btn:hover { border-color: #22c55e; color: #22c55e; }

.modal-footer {
  display: flex;
  justify-content: flex-end;
  gap: 10px;
  margin-top: 24px;
  padding-top: 20px;
  border-top: 1px solid #f1f5f9;
}

.btn {
  padding: 10px 20px;
  border-radius: 10px;
  font-size: 14px;
  font-weight: 600;
  cursor: pointer;
  border: none;
  transition: all var(--transition);
}

.btn-secondary {
  background: #f1f5f9;
  color: var(--sub);
}

.btn-secondary:hover { background: #e2e8f0; color: var(--text); }

.btn-primary {
  background: #22c55e;
  color: white;
}

.btn-primary:hover { background: #16a34a; transform: translateY(-1px); }

.btn-danger {
  background: #fef2f2;
  color: #ef4444;
}

.btn-danger:hover { background: #fee2e2; }

/* Settings panel */
.settings-panel {
  position: fixed;
  top: 0; right: -420px;
  width: 400px;
  height: 100vh;
  background: white;
  z-index: 200;
  box-shadow: -8px 0 32px rgba(0,0,0,0.15);
  transition: right 0.3s cubic-bezier(.4,0,.2,1);
  overflow-y: auto;
}

.settings-panel.open { right: 0; }

.settings-backdrop {
  position: fixed; inset: 0; z-index: 199;
  background: rgba(0,0,0,0.3);
  display: none;
}

.settings-backdrop.show { display: block; }

.settings-header {
  padding: 24px;
  border-bottom: 1px solid #f1f5f9;
  display: flex;
  justify-content: space-between;
  align-items: center;
  position: sticky; top: 0;
  background: white;
  z-index: 1;
}

.settings-header h2 {
  font-size: 18px;
  font-weight: 700;
}

.settings-nav {
  display: flex;
  flex-direction: column;
  padding: 16px;
  gap: 2px;
  border-bottom: 1px solid #f1f5f9;
}

.settings-nav-item {
  padding: 10px 14px;
  border-radius: 10px;
  cursor: pointer;
  font-size: 14px;
  font-weight: 500;
  color: var(--sub);
  transition: all var(--transition);
  display: flex; align-items: center; gap: 10px;
}

.settings-nav-item:hover { background: #f8fafc; color: var(--text); }
.settings-nav-item.active { background: #f0fdf4; color: #16a34a; font-weight: 600; }

.settings-section {
  padding: 24px;
  display: none;
}

.settings-section.active { display: block; }

.settings-section h3 {
  font-size: 16px;
  font-weight: 700;
  margin-bottom: 20px;
  color: var(--text);
}

/* User card */
.user-card {
  background: #f8fafc;
  border-radius: 12px;
  padding: 14px 16px;
  display: flex;
  align-items: center;
  justify-content: space-between;
  margin-bottom: 10px;
}

.user-info { display: flex; flex-direction: column; gap: 2px; }
.user-name { font-size: 14px; font-weight: 600; }
.user-meta { font-size: 12px; color: var(--sub); }

.badge {
  padding: 2px 8px;
  border-radius: 6px;
  font-size: 11px;
  font-weight: 600;
}

.badge-admin { background: #fef3c7; color: #d97706; }
.badge-user { background: #f0fdf4; color: #16a34a; }

/* Wallpaper grid */
.wallpaper-presets {
  display: grid;
  grid-template-columns: repeat(3, 1fr);
  gap: 10px;
  margin-bottom: 16px;
}

.wallpaper-preset {
  aspect-ratio: 16/9;
  border-radius: 10px;
  cursor: pointer;
  overflow: hidden;
  border: 3px solid transparent;
  transition: all var(--transition);
  position: relative;
}

.wallpaper-preset:hover, .wallpaper-preset.selected {
  border-color: #22c55e;
  transform: scale(1.03);
}

.wallpaper-preset img {
  width: 100%; height: 100%; object-fit: cover;
}

.wallpaper-preset.none-preset {
  background: linear-gradient(135deg, #e2e8f0, #cbd5e1);
  display: flex;
  align-items: center;
  justify-content: center;
  font-size: 12px;
  color: var(--sub);
  font-weight: 500;
}

/* Toast */
.toast {
  position: fixed;
  bottom: 30px;
  left: 50%;
  transform: translateX(-50%) translateY(100px);
  background: rgba(0,0,0,0.8);
  color: white;
  padding: 10px 20px;
  border-radius: 20px;
  font-size: 14px;
  z-index: 9999;
  transition: transform 0.3s;
  backdrop-filter: blur(10px);
}

.toast.show { transform: translateX(-50%) translateY(0); }

/* Drag sort */
.app-card.dragging { opacity: 0.5; }
.app-card.drag-over .app-icon-wrap { border: 2px dashed rgba(255,255,255,0.8); }

/* Responsive */
@media (max-width: 600px) {
  .dashboard-content { padding: 0 16px 24px; }
  .apps-grid { gap: 14px; }
  .app-card { width: 76px; }
  .app-icon-wrap { width: 60px; height: 60px; }
  .settings-panel { width: 100%; }
}
</style>
</head>
<body>

<!-- ===== LOGIN PAGE ===== -->
<div id="login-page">
  <div class="login-blob login-blob-1"></div>
  <div class="login-blob login-blob-2"></div>
  <div class="login-blob login-blob-3"></div>
  <div class="login-blob login-blob-4"></div>
  
  <div class="login-card">
    <div style="display:flex;justify-content:space-between;align-items:center;margin-bottom:8px;">
      <div class="login-logo">
        <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
          <rect x="3" y="3" width="7" height="7" rx="1"/><rect x="14" y="3" width="7" height="7" rx="1"/>
          <rect x="14" y="14" width="7" height="7" rx="1"/><rect x="3" y="14" width="7" height="7" rx="1"/>
        </svg>
      </div>
    </div>
    <div class="login-title">EasyPanel</div>
    
    <div class="form-group">
      <span class="input-icon">üë§</span>
      <input type="text" id="login-username" placeholder="Ë¥¶Âè∑" autocomplete="username">
    </div>
    
    <div class="form-group">
      <span class="input-icon">üîí</span>
      <input type="password" id="login-password" placeholder="ÂØÜÁ†Å" autocomplete="current-password">
    </div>
    
    <p class="error-msg" id="login-error">Ë¥¶Âè∑ÊàñÂØÜÁ†ÅÈîôËØØ</p>
    
    <button class="login-btn" onclick="doLogin()">ÁôªÂΩï</button>
    
    <p class="login-footer">Powered By EasyPanel</p>
  </div>
</div>

<!-- ===== DASHBOARD PAGE ===== -->
<div id="dashboard-page">
  <div class="wallpaper-bg" id="wallpaper-bg"></div>
  <div class="wallpaper-overlay"></div>
  
  <div class="dashboard-content">
    <!-- Header -->
    <div class="dash-header">
      <div class="dash-logo-area">
        <img class="dash-logo" id="dash-logo" src="" alt="logo">
        <span class="panel-title-text" id="panel-title-text">EasyPanel</span>
      </div>
      <button class="settings-btn" onclick="openSettings()" title="ËÆæÁΩÆ">
        <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
          <circle cx="12" cy="12" r="3"/>
          <path d="M19.4 15a1.65 1.65 0 0 0 .33 1.82l.06.06a2 2 0 0 1-2.83 2.83l-.06-.06a1.65 1.65 0 0 0-1.82-.33 1.65 1.65 0 0 0-1 1.51V21a2 2 0 0 1-4 0v-.09A1.65 1.65 0 0 0 9 19.4a1.65 1.65 0 0 0-1.82.33l-.06.06a2 2 0 0 1-2.83-2.83l.06-.06A1.65 1.65 0 0 0 4.68 15a1.65 1.65 0 0 0-1.51-1H3a2 2 0 0 1 0-4h.09A1.65 1.65 0 0 0 4.6 9a1.65 1.65 0 0 0-.33-1.82l-.06-.06a2 2 0 0 1 2.83-2.83l.06.06A1.65 1.65 0 0 0 9 4.68a1.65 1.65 0 0 0 1-1.51V3a2 2 0 0 1 4 0v.09a1.65 1.65 0 0 0 1 1.51 1.65 1.65 0 0 0 1.82-.33l.06-.06a2 2 0 0 1 2.83 2.83l-.06.06A1.65 1.65 0 0 0 19.4 9a1.65 1.65 0 0 0 1.51 1H21a2 2 0 0 1 0 4h-.09a1.65 1.65 0 0 0-1.51 1z"/>
        </svg>
      </button>
    </div>
    
    <!-- Hero -->
    <div class="hero-section">
      <div class="hero-hostname" id="hero-hostname">EasyPanel</div>
      <div class="hero-time" id="hero-time">00:00</div>
      <div class="hero-date" id="hero-date"></div>
    </div>
    
    <!-- Apps -->
    <div class="apps-section" id="apps-section"></div>
  </div>
</div>

<!-- ===== APP MODAL ===== -->
<div class="modal-overlay" id="app-modal">
  <div class="modal">
    <div class="modal-header">
      <div class="modal-title" id="modal-title">Ê∑ªÂä†È°πÁõÆ</div>
      <button class="modal-close" onclick="closeModal()">‚úï</button>
    </div>
    
    <!-- Preview -->
    <div class="preview-area">
      <div class="preview-icon" id="preview-icon">A</div>
      <div class="preview-info">
        <div class="preview-title" id="preview-title">Â∫îÁî®ÂêçÁß∞</div>
        <div class="preview-url" id="preview-url">https://...</div>
      </div>
    </div>
    
    <!-- Icon type -->
    <div class="form-row">
      <label class="form-label">ÂõæÊ†áÈ£éÊ†º</label>
      <div class="icon-tabs">
        <button class="icon-tab active" onclick="setIconType('text')">ÊñáÂ≠ó</button>
        <button class="icon-tab" onclick="setIconType('image')">ÂõæÁâá</button>
      </div>
      
      <!-- Text icon -->
      <div id="icon-text-area">
        <input type="text" class="form-input" id="icon-text-input" placeholder="ÊñáÂ≠óÂÜÖÂÆπÔºàÊúÄÂ§ö2Â≠óÁ¨¶Ôºâ" maxlength="2" oninput="updatePreview()">
      </div>
      
      <!-- Image icon -->
      <div id="icon-image-area" style="display:none">
        <div class="image-upload-area">
          <input type="text" class="form-input image-url-input" id="icon-image-url" placeholder="ËæìÂÖ•ÂõæÊ†áÂú∞ÂùÄÊàñ‰∏ä‰º†" oninput="updatePreview()">
          <label class="upload-btn" for="icon-image-file">
            <span>üìÅ</span> Êú¨Âú∞‰∏ä‰º†
          </label>
          <input type="file" id="icon-image-file" accept="image/*" style="display:none" onchange="handleImageUpload(this)">
        </div>
      </div>
    </div>
    
    <!-- Title -->
    <div class="form-row">
      <label class="form-label">Ê†áÈ¢ò <span style="color:#ef4444">*</span></label>
      <input type="text" class="form-input" id="app-title" placeholder="ËØ∑ËæìÂÖ•" maxlength="20" oninput="updatePreview()">
    </div>
    
    <!-- URL -->
    <div class="form-row">
      <label class="form-label">ÈªòËÆ§Âú∞ÂùÄ <span style="color:#ef4444">*</span></label>
      <input type="text" class="form-input" id="app-url" placeholder="http(s)://" oninput="updatePreview()">
    </div>
    
    <!-- Open type -->
    <div class="form-row">
      <label class="form-label">ÊâìÂºÄÊñπÂºè</label>
      <select class="form-input" id="app-open-type">
        <option value="new_tab">Êñ∞Á™óÂè£ÊâìÂºÄ</option>
        <option value="current">ÂΩìÂâçÁ™óÂè£</option>
      </select>
    </div>
    
    <div class="modal-footer">
      <button class="btn btn-danger" id="modal-delete-btn" onclick="deleteCurrentApp()" style="display:none">Âà†Èô§</button>
      <button class="btn btn-secondary" onclick="closeModal()">ÂèñÊ∂à</button>
      <button class="btn btn-primary" onclick="saveApp()">‰øùÂ≠ò</button>
    </div>
  </div>
</div>

<!-- ===== SETTINGS PANEL ===== -->
<div class="settings-backdrop" id="settings-backdrop" onclick="closeSettings()"></div>
<div class="settings-panel" id="settings-panel">
  <div class="settings-header">
    <h2>ËÆæÁΩÆ</h2>
    <button class="modal-close" onclick="closeSettings()">‚úï</button>
  </div>
  
  <div class="settings-nav">
    <div class="settings-nav-item active" onclick="switchSettingsTab('account')">üë§ Ë¥¶Êà∑‰ø°ÊÅØ</div>
    <div class="settings-nav-item" onclick="switchSettingsTab('panel')">üñ•Ô∏è Èù¢ÊùøËÆæÁΩÆ</div>
    <div class="settings-nav-item" onclick="switchSettingsTab('wallpaper')">üñºÔ∏è Â£ÅÁ∫∏ËÆæÁΩÆ</div>
    <div class="settings-nav-item" onclick="switchSettingsTab('users')">üë• Áî®Êà∑ÁÆ°ÁêÜ</div>
  </div>
  
  <!-- Account settings -->
  <div class="settings-section active" id="settings-account">
    <h3>Ë¥¶Êà∑‰ø°ÊÅØ</h3>
    <div class="form-row">
      <label class="form-label">Ë¥¶Âè∑</label>
      <input type="text" class="form-input" id="settings-username" disabled>
    </div>
    <div class="form-row">
      <label class="form-label">ÊòµÁß∞</label>
      <input type="text" class="form-input" id="settings-nickname" placeholder="ËæìÂÖ•ÊòµÁß∞">
    </div>
    <button class="btn btn-primary" style="width:100%;margin-bottom:16px" onclick="saveNickname()">‰øùÂ≠òÊòµÁß∞</button>
    
    <h3 style="margin-top:20px">‰øÆÊîπÂØÜÁ†Å</h3>
    <div class="form-row">
      <label class="form-label">ÊóßÂØÜÁ†Å</label>
      <input type="password" class="form-input" id="settings-old-pwd" placeholder="ËæìÂÖ•ÊóßÂØÜÁ†Å">
    </div>
    <div class="form-row">
      <label class="form-label">Êñ∞ÂØÜÁ†Å</label>
      <input type="password" class="form-input" id="settings-new-pwd" placeholder="ËæìÂÖ•Êñ∞ÂØÜÁ†Å">
    </div>
    <button class="btn btn-primary" style="width:100%" onclick="changePassword()">‰øÆÊîπÂØÜÁ†Å</button>
    
    <div style="margin-top:24px;padding-top:20px;border-top:1px solid #f1f5f9">
      <button class="btn btn-danger" style="width:100%" onclick="doLogout()">ÈÄÄÂá∫ÁôªÂΩï</button>
    </div>
  </div>
  
  <!-- Panel settings -->
  <div class="settings-section" id="settings-panel-section">
    <h3>Èù¢ÊùøËÆæÁΩÆ</h3>
    <div class="form-row">
      <label class="form-label">ÊòæÁ§∫‰∏ªÊú∫Âêç</label>
      <input type="text" class="form-input" id="settings-hostname" placeholder="Ëá™ÂÆö‰πâ‰∏ªÊú∫Âêç">
    </div>
    <div class="form-row">
      <label class="form-label">Èù¢ÊùøÊ†áÈ¢ò</label>
      <input type="text" class="form-input" id="settings-title" placeholder="EasyPanel">
    </div>
    <div class="form-row">
      <label class="form-label">LOGOÔºàURL Êàñ‰∏ä‰º†Ôºâ</label>
      <div class="image-upload-area">
        <input type="text" class="form-input image-url-input" id="settings-logo-url" placeholder="https://...">
        <label class="upload-btn" for="logo-upload-file">üìÅ ‰∏ä‰º†</label>
        <input type="file" id="logo-upload-file" accept="image/*" style="display:none" onchange="handleLogoUpload(this)">
      </div>
      <img id="logo-preview" style="width:60px;height:60px;border-radius:10px;margin-top:8px;object-fit:cover;display:none">
    </div>
    <button class="btn btn-primary" style="width:100%" onclick="savePanelSettings()">‰øùÂ≠òËÆæÁΩÆ</button>
  </div>
  
  <!-- Wallpaper settings -->
  <div class="settings-section" id="settings-wallpaper">
    <h3>Â£ÅÁ∫∏ËÆæÁΩÆ</h3>
    <div class="wallpaper-presets" id="wallpaper-presets">
      <div class="wallpaper-preset none-preset" onclick="selectWallpaper('')">Êó†Â£ÅÁ∫∏</div>
    </div>
    <div class="form-row">
      <label class="form-label">Â£ÅÁ∫∏ URL</label>
      <div class="image-upload-area">
        <input type="text" class="form-input image-url-input" id="wallpaper-url-input" placeholder="https://..." oninput="previewWallpaper(this.value)">
        <label class="upload-btn" for="wallpaper-upload">üìÅ ‰∏ä‰º†</label>
        <input type="file" id="wallpaper-upload" accept="image/*" style="display:none" onchange="handleWallpaperUpload(this)">
      </div>
    </div>
    <button class="btn btn-primary" style="width:100%;margin-top:8px" onclick="saveWallpaper()">Â∫îÁî®Â£ÅÁ∫∏</button>
  </div>
  
  <!-- Users management -->
  <div class="settings-section" id="settings-users">
    <h3>Áî®Êà∑ÁÆ°ÁêÜ</h3>
    <div id="users-list"></div>
    <div style="margin-top:20px;border-top:1px solid #f1f5f9;padding-top:20px">
      <h3 style="margin-bottom:16px">Ê∑ªÂä†Áî®Êà∑</h3>
      <div class="form-row">
        <label class="form-label">Ë¥¶Âè∑</label>
        <input type="text" class="form-input" id="new-username" placeholder="Ë¥¶Âè∑">
      </div>
      <div class="form-row">
        <label class="form-label">ÂØÜÁ†Å</label>
        <input type="password" class="form-input" id="new-password" placeholder="ÂØÜÁ†Å">
      </div>
      <div class="form-row">
        <label class="form-label">ÊòµÁß∞</label>
        <input type="text" class="form-input" id="new-nickname" placeholder="ÊòµÁß∞ÔºàÂèØÈÄâÔºâ">
      </div>
      <button class="btn btn-primary" style="width:100%" onclick="addUser()">Ê∑ªÂä†Áî®Êà∑</button>
    </div>
  </div>
</div>

<!-- Toast -->
<div class="toast" id="toast"></div>

<script>
// ===== STATE =====
let apps = [];
let panelInfo = {};
let currentUser = {};
let editingAppId = null;
let currentIconType = 'text';
let dragSrcId = null;
let wallpaperPresets = [
  'https://images.unsplash.com/photo-1419242902214-272b3f66ee7a?w=800&q=80',
  'https://images.unsplash.com/photo-1506905925346-21bda4d32df4?w=800&q=80',
  'https://images.unsplash.com/photo-1540206395-68808572332f?w=800&q=80',
  'https://images.unsplash.com/photo-1518895949257-7621c3c786d7?w=800&q=80',
  'https://images.unsplash.com/photo-1554080353-a576cf803bda?w=800&q=80',
];

// ===== INIT =====
async function init() {
  // Check if logged in
  try {
    const me = await api('/api/me');
    currentUser = me;
    showDashboard();
  } catch {
    showLogin();
  }
}

function showLogin() {
  document.getElementById('login-page').style.display = 'flex';
  document.getElementById('dashboard-page').style.display = 'none';
  document.getElementById('login-username').focus();
}

async function showDashboard() {
  document.getElementById('login-page').style.display = 'none';
  document.getElementById('dashboard-page').style.display = 'block';
  await loadPanelInfo();
  await loadApps();
  startClock();
}

// ===== API =====
async function api(url, options = {}) {
  const res = await fetch(url, {
    headers: { 'Content-Type': 'application/json' },
    credentials: 'include',
    ...options,
  });
  if (!res.ok) {
    const err = await res.json().catch(() => ({}));
    throw new Error(err.error || 'Request failed');
  }
  return res.json();
}

// ===== LOGIN =====
async function doLogin() {
  const username = document.getElementById('login-username').value.trim();
  const password = document.getElementById('login-password').value;
  const errorEl = document.getElementById('login-error');
  errorEl.style.display = 'none';
  
  try {
    const res = await api('/api/login', {
      method: 'POST',
      body: JSON.stringify({ username, password })
    });
    currentUser = res;
    showDashboard();
  } catch (e) {
    errorEl.style.display = 'block';
  }
}

document.getElementById('login-password').addEventListener('keydown', e => {
  if (e.key === 'Enter') doLogin();
});

async function doLogout() {
  await api('/api/logout', { method: 'POST' }).catch(() => {});
  closeSettings();
  showLogin();
}

// ===== LOAD DATA =====
async function loadPanelInfo() {
  try {
    panelInfo = await api('/api/panel');
    document.getElementById('hero-hostname').textContent = panelInfo.hostname || panelInfo.title;
    document.getElementById('panel-title-text').textContent = panelInfo.title || 'EasyPanel';
    
    if (panelInfo.wallpaper) {
      document.getElementById('wallpaper-bg').style.backgroundImage = `url(${panelInfo.wallpaper})`;
    } else {
      document.getElementById('wallpaper-bg').style.backgroundImage = 'linear-gradient(135deg, #1e3a5f 0%, #2d6a4f 50%, #1e3a5f 100%)';
    }
    
    if (panelInfo.logo) {
      const logoEl = document.getElementById('dash-logo');
      logoEl.src = panelInfo.logo;
      logoEl.style.display = 'block';
    }
  } catch(e) {
    console.error(e);
  }
}

async function loadApps() {
  try {
    apps = await api('/api/apps');
    renderApps();
  } catch(e) {
    console.error(e);
  }
}

// ===== RENDER APPS =====
function renderApps() {
  const section = document.getElementById('apps-section');
  section.innerHTML = '';
  
  // Group label
  const label = document.createElement('div');
  label.className = 'group-label';
  label.textContent = 'APP';
  section.appendChild(label);
  
  const grid = document.createElement('div');
  grid.className = 'apps-grid';
  grid.id = 'apps-grid';
  
  apps.forEach(app => {
    grid.appendChild(createAppCard(app));
  });
  
  // Add button
  const addCard = document.createElement('div');
  addCard.className = 'add-app-card';
  addCard.onclick = () => openAddModal();
  addCard.innerHTML = `
    <div class="add-app-icon">+</div>
    <div class="add-app-name">Ê∑ªÂä†</div>
  `;
  grid.appendChild(addCard);
  
  section.appendChild(grid);
}

function createAppCard(app) {
  const card = document.createElement('div');
  card.className = 'app-card';
  card.dataset.id = app.id;
  card.draggable = true;
  
  // Drag events
  card.addEventListener('dragstart', e => {
    dragSrcId = app.id;
    card.classList.add('dragging');
  });
  card.addEventListener('dragend', () => card.classList.remove('dragging'));
  card.addEventListener('dragover', e => { e.preventDefault(); card.classList.add('drag-over'); });
  card.addEventListener('dragleave', () => card.classList.remove('drag-over'));
  card.addEventListener('drop', e => {
    e.preventDefault();
    card.classList.remove('drag-over');
    if (dragSrcId && dragSrcId !== app.id) {
      reorderApps(dragSrcId, app.id);
    }
  });
  
  // Icon
  let iconHtml = '';
  if (app.icon_type === 'image' && app.icon_image) {
    iconHtml = `<img class="app-icon" src="${app.icon_image}" alt="${app.title}" onerror="this.style.display='none';this.nextElementSibling.style.display='flex'">
      <div class="app-icon-text" style="display:none">${(app.title||'?')[0]}</div>`;
  } else {
    const text = app.icon_text || (app.title||'?')[0];
    iconHtml = `<div class="app-icon-text">${text}</div>`;
  }
  
  card.innerHTML = `
    <div class="app-actions">
      <button class="app-action-btn add" title="Ê∑ªÂä†" onclick="openAddModal(event)">+</button>
      <button class="app-action-btn edit" title="ÁºñËæë" onclick="openEditModal(event, '${app.id}')">‚úé</button>
      <button class="app-action-btn delete" title="Âà†Èô§" onclick="quickDeleteApp(event, '${app.id}')">‚úï</button>
    </div>
    <div class="app-icon-wrap">
      ${iconHtml}
    </div>
    <div class="app-name">${app.title}</div>
  `;
  
  // Click to open
  card.querySelector('.app-icon-wrap').addEventListener('click', () => {
    const url = app.url;
    if (app.open_type === 'current') {
      window.location.href = url;
    } else {
      window.open(url, '_blank');
    }
  });
  
  return card;
}

// ===== DRAG REORDER =====
async function reorderApps(srcId, targetId) {
  const srcIdx = apps.findIndex(a => a.id === srcId);
  const targetIdx = apps.findIndex(a => a.id === targetId);
  if (srcIdx < 0 || targetIdx < 0) return;
  
  const [item] = apps.splice(srcIdx, 1);
  apps.splice(targetIdx, 0, item);
  
  renderApps();
  
  await api('/api/apps/reorder', {
    method: 'POST',
    body: JSON.stringify({ ids: apps.map(a => a.id) })
  }).catch(console.error);
}

// ===== MODAL =====
function openAddModal(e) {
  if (e) e.stopPropagation();
  editingAppId = null;
  document.getElementById('modal-title').textContent = 'Ê∑ªÂä†È°πÁõÆ';
  document.getElementById('modal-delete-btn').style.display = 'none';
  resetModal();
  document.getElementById('app-modal').classList.add('show');
}

function openEditModal(e, id) {
  if (e) e.stopPropagation();
  const app = apps.find(a => a.id === id);
  if (!app) return;
  editingAppId = id;
  document.getElementById('modal-title').textContent = 'ÁºñËæëÈ°πÁõÆ';
  document.getElementById('modal-delete-btn').style.display = 'block';
  
  setIconType(app.icon_type || 'text');
  document.getElementById('icon-text-input').value = app.icon_text || '';
  document.getElementById('icon-image-url').value = app.icon_image || '';
  document.getElementById('app-title').value = app.title || '';
  document.getElementById('app-url').value = app.url || '';
  document.getElementById('app-open-type').value = app.open_type || 'new_tab';
  
  updatePreview();
  document.getElementById('app-modal').classList.add('show');
}

function closeModal() {
  document.getElementById('app-modal').classList.remove('show');
}

function resetModal() {
  setIconType('text');
  document.getElementById('icon-text-input').value = '';
  document.getElementById('icon-image-url').value = '';
  document.getElementById('app-title').value = '';
  document.getElementById('app-url').value = '';
  document.getElementById('app-open-type').value = 'new_tab';
  updatePreview();
}

function setIconType(type) {
  currentIconType = type;
  document.querySelectorAll('.icon-tab').forEach((t, i) => {
    t.classList.toggle('active', (i === 0 && type === 'text') || (i === 1 && type === 'image'));
  });
  document.getElementById('icon-text-area').style.display = type === 'text' ? 'block' : 'none';
  document.getElementById('icon-image-area').style.display = type === 'image' ? 'block' : 'none';
  updatePreview();
}

function updatePreview() {
  const title = document.getElementById('app-title').value || 'Â∫îÁî®ÂêçÁß∞';
  const url = document.getElementById('app-url').value || 'https://...';
  const iconText = document.getElementById('icon-text-input').value || title[0];
  const iconImage = document.getElementById('icon-image-url').value;
  
  document.getElementById('preview-title').textContent = title;
  document.getElementById('preview-url').textContent = url;
  
  const iconEl = document.getElementById('preview-icon');
  if (currentIconType === 'image' && iconImage) {
    iconEl.innerHTML = `<img src="${iconImage}" style="width:100%;height:100%;object-fit:cover;border-radius:11px" onerror="this.parentElement.textContent='${iconText[0]}'">`;
  } else {
    iconEl.textContent = iconText.substring(0, 2);
  }
}

async function handleImageUpload(input) {
  if (!input.files[0]) return;
  const formData = new FormData();
  formData.append('image', input.files[0]);
  
  try {
    const res = await fetch('/api/upload', { method: 'POST', body: formData, credentials: 'include' });
    const data = await res.json();
    document.getElementById('icon-image-url').value = data.url;
    updatePreview();
  } catch(e) {
    showToast('‰∏ä‰º†Â§±Ë¥•');
  }
}

async function saveApp() {
  const title = document.getElementById('app-title').value.trim();
  const url = document.getElementById('app-url').value.trim();
  
  if (!title || !url) {
    showToast('ËØ∑Â°´ÂÜôÊ†áÈ¢òÂíåÂú∞ÂùÄ');
    return;
  }
  
  const app = {
    title,
    url,
    icon_type: currentIconType,
    icon_text: document.getElementById('icon-text-input').value,
    icon_image: document.getElementById('icon-image-url').value,
    open_type: document.getElementById('app-open-type').value,
  };
  
  try {
    if (editingAppId) {
      await api(`/api/apps/${editingAppId}`, { method: 'PUT', body: JSON.stringify(app) });
    } else {
      await api('/api/apps', { method: 'POST', body: JSON.stringify(app) });
    }
    closeModal();
    await loadApps();
    showToast('‰øùÂ≠òÊàêÂäü ‚úì');
  } catch(e) {
    showToast('‰øùÂ≠òÂ§±Ë¥•: ' + e.message);
  }
}

async function deleteCurrentApp() {
  if (!editingAppId) return;
  if (!confirm('Á°ÆËÆ§Âà†Èô§Ê≠§Â∫îÁî®Ôºü')) return;
  try {
    await api(`/api/apps/${editingAppId}`, { method: 'DELETE' });
    closeModal();
    await loadApps();
    showToast('Â∑≤Âà†Èô§');
  } catch(e) {
    showToast('Âà†Èô§Â§±Ë¥•');
  }
}

async function quickDeleteApp(e, id) {
  e.stopPropagation();
  if (!confirm('Á°ÆËÆ§Âà†Èô§Ôºü')) return;
  try {
    await api(`/api/apps/${id}`, { method: 'DELETE' });
    await loadApps();
    showToast('Â∑≤Âà†Èô§');
  } catch(e) {
    showToast('Âà†Èô§Â§±Ë¥•');
  }
}

// ===== CLOCK =====
function startClock() {
  function update() {
    const now = new Date();
    const h = String(now.getHours()).padStart(2, '0');
    const m = String(now.getMinutes()).padStart(2, '0');
    document.getElementById('hero-time').textContent = `${h}:${m}`;
    
    const days = ['ÊòüÊúüÊó•', 'ÊòüÊúü‰∏Ä', 'ÊòüÊúü‰∫å', 'ÊòüÊúü‰∏â', 'ÊòüÊúüÂõõ', 'ÊòüÊúü‰∫î', 'ÊòüÊúüÂÖ≠'];
    const months = now.getMonth() + 1;
    const dates = now.getDate();
    document.getElementById('hero-date').textContent = `${months}-${dates} ${days[now.getDay()]}`;
  }
  update();
  setInterval(update, 10000);
}

// ===== SETTINGS =====
function openSettings() {
  document.getElementById('settings-panel').classList.add('open');
  document.getElementById('settings-backdrop').classList.add('show');
  
  // Fill current values
  document.getElementById('settings-username').value = currentUser.username || '';
  document.getElementById('settings-nickname').value = currentUser.nickname || '';
  document.getElementById('settings-hostname').value = panelInfo.hostname || '';
  document.getElementById('settings-title').value = panelInfo.title || '';
  document.getElementById('settings-logo-url').value = panelInfo.logo || '';
  document.getElementById('wallpaper-url-input').value = panelInfo.wallpaper || '';
  
  if (panelInfo.logo) {
    document.getElementById('logo-preview').src = panelInfo.logo;
    document.getElementById('logo-preview').style.display = 'block';
  }
  
  loadWallpaperPresets();
  loadUsers();
}

function closeSettings() {
  document.getElementById('settings-panel').classList.remove('open');
  document.getElementById('settings-backdrop').classList.remove('show');
}

function switchSettingsTab(tab) {
  document.querySelectorAll('.settings-nav-item').forEach((el, i) => {
    const tabs = ['account', 'panel', 'wallpaper', 'users'];
    el.classList.toggle('active', tabs[i] === tab);
  });
  document.querySelectorAll('.settings-section').forEach(el => el.classList.remove('active'));
  const mapping = {
    account: 'settings-account',
    panel: 'settings-panel-section',
    wallpaper: 'settings-wallpaper',
    users: 'settings-users'
  };
  document.getElementById(mapping[tab]).classList.add('active');
}

async function saveNickname() {
  const nickname = document.getElementById('settings-nickname').value.trim();
  try {
    await api('/api/me/nickname', { method: 'PUT', body: JSON.stringify({ nickname }) });
    currentUser.nickname = nickname;
    showToast('ÊòµÁß∞Â∑≤‰øùÂ≠ò ‚úì');
  } catch(e) {
    showToast('‰øùÂ≠òÂ§±Ë¥•');
  }
}

async function changePassword() {
  const oldPwd = document.getElementById('settings-old-pwd').value;
  const newPwd = document.getElementById('settings-new-pwd').value;
  if (!oldPwd || !newPwd) { showToast('ËØ∑Â°´ÂÜôÂØÜÁ†Å'); return; }
  try {
    await api('/api/me/password', { method: 'PUT', body: JSON.stringify({ old_password: oldPwd, new_password: newPwd }) });
    document.getElementById('settings-old-pwd').value = '';
    document.getElementById('settings-new-pwd').value = '';
    showToast('ÂØÜÁ†ÅÂ∑≤‰øÆÊîπ ‚úì');
  } catch(e) {
    showToast('‰øÆÊîπÂ§±Ë¥•: ' + e.message);
  }
}

async function savePanelSettings() {
  const settings = {
    hostname: document.getElementById('settings-hostname').value.trim(),
    title: document.getElementById('settings-title').value.trim(),
    logo: document.getElementById('settings-logo-url').value.trim(),
    wallpaper: panelInfo.wallpaper || '',
  };
  try {
    await api('/api/settings', { method: 'PUT', body: JSON.stringify(settings) });
    panelInfo = { ...panelInfo, ...settings };
    await loadPanelInfo();
    showToast('ËÆæÁΩÆÂ∑≤‰øùÂ≠ò ‚úì');
  } catch(e) {
    showToast('‰øùÂ≠òÂ§±Ë¥•');
  }
}

async function handleLogoUpload(input) {
  if (!input.files[0]) return;
  const formData = new FormData();
  formData.append('logo', input.files[0]);
  try {
    const res = await fetch('/api/upload/logo', { method: 'POST', body: formData, credentials: 'include' });
    const data = await res.json();
    document.getElementById('settings-logo-url').value = data.url;
    document.getElementById('logo-preview').src = data.url;
    document.getElementById('logo-preview').style.display = 'block';
  } catch(e) {
    showToast('‰∏ä‰º†Â§±Ë¥•');
  }
}

// Wallpaper
function loadWallpaperPresets() {
  const container = document.getElementById('wallpaper-presets');
  container.innerHTML = `<div class="wallpaper-preset none-preset ${!panelInfo.wallpaper ? 'selected' : ''}" onclick="selectWallpaper('')">Êó†Â£ÅÁ∫∏</div>`;
  wallpaperPresets.forEach(url => {
    const el = document.createElement('div');
    el.className = 'wallpaper-preset' + (panelInfo.wallpaper === url ? ' selected' : '');
    el.onclick = () => selectWallpaper(url);
    el.innerHTML = `<img src="${url}" loading="lazy">`;
    container.appendChild(el);
  });
}

function selectWallpaper(url) {
  document.getElementById('wallpaper-url-input').value = url;
  previewWallpaper(url);
  document.querySelectorAll('.wallpaper-preset').forEach(el => el.classList.remove('selected'));
  if (!url) {
    document.querySelector('.none-preset').classList.add('selected');
  }
}

function previewWallpaper(url) {
  if (url) {
    document.getElementById('wallpaper-bg').style.backgroundImage = `url(${url})`;
  } else {
    document.getElementById('wallpaper-bg').style.backgroundImage = 'linear-gradient(135deg, #1e3a5f 0%, #2d6a4f 50%, #1e3a5f 100%)';
  }
}

async function handleWallpaperUpload(input) {
  if (!input.files[0]) return;
  const formData = new FormData();
  formData.append('wallpaper', input.files[0]);
  try {
    const res = await fetch('/api/upload/wallpaper', { method: 'POST', body: formData, credentials: 'include' });
    const data = await res.json();
    document.getElementById('wallpaper-url-input').value = data.url;
    previewWallpaper(data.url);
    showToast('‰∏ä‰º†ÊàêÂäü');
  } catch(e) {
    showToast('‰∏ä‰º†Â§±Ë¥•');
  }
}

async function saveWallpaper() {
  const url = document.getElementById('wallpaper-url-input').value.trim();
  const settings = { ...panelInfo, wallpaper: url };
  try {
    await api('/api/settings', { method: 'PUT', body: JSON.stringify(settings) });
    panelInfo.wallpaper = url;
    previewWallpaper(url);
    showToast('Â£ÅÁ∫∏Â∑≤‰øùÂ≠ò ‚úì');
  } catch(e) {
    showToast('‰øùÂ≠òÂ§±Ë¥•');
  }
}

// Users
async function loadUsers() {
  try {
    const users = await api('/api/users');
    const container = document.getElementById('users-list');
    container.innerHTML = users.map(u => `
      <div class="user-card">
        <div class="user-info">
          <div class="user-name">${u.nickname || u.username}</div>
          <div class="user-meta">@${u.username}</div>
        </div>
        <div style="display:flex;align-items:center;gap:8px">
          <span class="badge ${u.is_admin ? 'badge-admin' : 'badge-user'}">${u.is_admin ? 'ÁÆ°ÁêÜÂëò' : 'Áî®Êà∑'}</span>
          ${u.username !== currentUser.username ? `<button class="btn btn-danger" style="padding:4px 10px;font-size:12px" onclick="removeUser('${u.username}')">Âà†Èô§</button>` : ''}
        </div>
      </div>
    `).join('');
  } catch(e) {
    console.error(e);
  }
}

async function addUser() {
  const username = document.getElementById('new-username').value.trim();
  const password = document.getElementById('new-password').value;
  const nickname = document.getElementById('new-nickname').value.trim();
  if (!username || !password) { showToast('ËØ∑Â°´ÂÜôË¥¶Âè∑ÂíåÂØÜÁ†Å'); return; }
  try {
    await api('/api/users', { method: 'POST', body: JSON.stringify({ username, password, nickname }) });
    document.getElementById('new-username').value = '';
    document.getElementById('new-password').value = '';
    document.getElementById('new-nickname').value = '';
    await loadUsers();
    showToast('Áî®Êà∑Â∑≤Ê∑ªÂä† ‚úì');
  } catch(e) {
    showToast('Ê∑ªÂä†Â§±Ë¥•: ' + e.message);
  }
}

async function removeUser(username) {
  if (!confirm(`Á°ÆËÆ§Âà†Èô§Áî®Êà∑ ${username}Ôºü`)) return;
  try {
    await api(`/api/users/${username}`, { method: 'DELETE' });
    await loadUsers();
    showToast('Â∑≤Âà†Èô§');
  } catch(e) {
    showToast('Âà†Èô§Â§±Ë¥•');
  }
}

// ===== TOAST =====
let toastTimer;
function showToast(msg) {
  const el = document.getElementById('toast');
  el.textContent = msg;
  el.classList.add('show');
  clearTimeout(toastTimer);
  toastTimer = setTimeout(() => el.classList.remove('show'), 2500);
}

// Close modal on overlay click
document.getElementById('app-modal').addEventListener('click', function(e) {
  if (e.target === this) closeModal();
});

// Start
init();
</script>
</body>
</html>
